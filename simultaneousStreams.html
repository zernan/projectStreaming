<!DOCTYPE html>

<html>
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0"/>

<title>Javascript Project</title>
	
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/css/materialize.min.css">
  <link rel="stylesheet" href="streamingData.css">	

</head>

<body>
<div class='container'>

	<h4 align='center'>STREAMING WEB APP</h4>
	
	<div id='dragAndDrop1' class='drag'	draggable='true'>
			
			<!--<h3>Twitch Clips</h3> -->
			<div class='twitch'></div>
	</div>	

	

	<div id='dragAndDrop2' class='drag' draggable='true'>
				
		<!--<h3>Twitter Feed</h3> -->
		<div class='twitter'>
			<!-- <div id="twitter">
				<div id="twitter_t">
				</div>
				<div id="twitter_m">
				<div id="twitter_container">
				<ul id="twitter_update_list">
				</ul>
				</div>
				</div>
				</div>
				<div id="twitter_b">
				</div> -->
		</div>
	</div>
				
		
	<div id='dragAndDrop3' class='drag' draggable='true' align='center'>
				<h5>Type keyword to search streams</h5>
				<input type='text' id='txtBox'/>
				<button id='searchBtn' height=100px width=200px>Search</button>
	</div>
		
</div> <!-- end of class container -->
<div>
		<p id='coordinates'>COORDINATES</p>
</div>

<script>

		
	let _startX = 0;
 	let _startY = 0;
 	let _offsetX = 0;
  	let _offsetY = 0;
 	let	_dragElement;
 	let _oldZIndex = 0;
 	
 	let isDown = false;
 	let mouseOffset;
 	
 	//get blue wave container coordinates
 	let cont = document.getElementsByClassName('container')[0];
    let containerRect = cont.getBoundingClientRect();
    
 	document.onmousedown = OnMouseDown;
 	document.onmouseup = OnMouseUp;

 	function getMouseCoordinates(e) {
 		
 		if(e.pageX || e.pageY){ 
 			return {
 				x:e.pageX, y:e.pageY
 			}; 
	    }

	    //if scrolled, get the amount of scroll done on the docu and add that to the cordinates
		//since the mouse coordinates are relative to the current window view
		return { 
	        x:e.clientX + document.body.scrollLeft, 
	        y:e.clientY + document.body.scrollTop 
	    }; 
 	}

 	function getOffset(elem) {
  		elem = elem.getBoundingClientRect();
  		
  		return {
    		left: elem.left + window.scrollX,
    		top: elem.top + window.scrollY
  		}
	}

	function getMouseOffset(target, e){ 
		
	    if(e == null)
	      e = window.event; 
	    
	    let docPos    = getPosition(target); 
	    let mousePos  = getMouseCoordinates(e); 
	    return {
	    	x:mousePos.x - docPos.x, y:mousePos.y - docPos.y
	    }; 
	    
	} 
	
	function getPosition(e){ 
		
	    var left = 0; 
	    var top  = 0; 
	    while (e.offsetParent){ 
	        left += e.offsetLeft; 
	        top  += e.offsetTop; 
	        e     = e.offsetParent; 
	    } 

	    left += e.offsetLeft; 
	    top  += e.offsetTop; 

	    return {
	    	x:left, y:top
	    }; 
	} 

 	function ExtractNumber(value) {
	
    	var n = parseInt(value);
		
		return n == null || isNaN(n) ? 0 : n;
	}

	
	function OnMouseMove(e){
	
    	if (e == null) 
        	e = window.event; 

        // drag code

        //implementation of the newly added functions (for fixing because it did not do dragging at all)
    	let mousePos = getMouseCoordinates(e); 

    	//current element position taking into consideration mouse click position and window scrolls 
    	_dragElement.style.left = (e.clientX - containerRect.left - mouseOffset.x + window.scrollX) + 'px';
    	_dragElement.style.top = (e.clientY - mouseOffset.y + window.scrollY) + 'px';
    	
    	document.getElementById('coordinates').innerHTML = 'clientXY: ' + e.clientX + ',' + e.clientY + '\n dragElementXY: ' + _dragElement.style.left + ',' + _dragElement.style.top + '\n offsetXY:' + _offsetX + ',' + _offsetY + '\n targetOffsetXY: ' + e.target.offsetLeft + ',' + e.target.offsetTop + '\n mousePosition: ' + mousePos.x + ',' + mousePos.y + '\n mouseOffsetXY: ' + mouseOffset.x + ',' + mouseOffset.y;
    }

	function OnMouseUp(e){
		
		if (_dragElement != null) {

			let elementRect = _dragElement.getBoundingClientRect();			
			let leftPos = elementRect.left - containerRect.left;
			let topPos = elementRect.top - containerRect.top;
			let rightPos = elementRect.right - containerRect.right;
			let bottomPos = elementRect.bottom - containerRect.bottom;

			//alert(_dragElement.style.left + ',' + elementRect.left + ',' + rightPos);
			//alert('bottomPos =' + bottomPos + '\n elementBottom=' + elementRect.bottom + '\n container bottom=' + containerRect.bottom);

			if(rightPos > 0){
				
				_dragElement.style.left = (elementRect.left - rightPos - containerRect.left) + 'px';
			}

			if(bottomPos > 0){
				
				_dragElement.style.top = (elementRect.top - bottomPos + window.scrollY) + 'px';
			}
			
			if(_dragElement.style.top < '0px'){
				_dragElement.style.top = '0px';
			}

			if(_dragElement.style.left < '0px'){
				_dragElement.style.left = '0px';
			}
			

			//alert('\n ElementPosition = ' + elementRect.left + ',' + elementRect.top + ',' + elementRect.right + ',' + elementRect.bottom + '\n ContainerPosition = ' + containerRect.left + ',' + containerRect.top + ',' + containerRect.right + ',' + containerRect.bottom + '\n Position = ' + leftPos + ',' + topPos + ',' + rightPos + ',' + bottomPos);
    		
    		_dragElement.style.zIndex = _oldZIndex;

	        // cleanup
    	    document.onmousemove = null;
        	document.onselectstart = null;
        	_dragElement.ondragstart = null;
        	_dragElement = null;
        }
	}
	
	function OnMouseDown(e){
		
		//for IE not passing event objects
		if(e == null) {
			e = window.event;
		}
		
		isDown = true;

		//e.stopPropagation();

		let target = e.target != null ? e.target : e.srcElement;

		if (target.className == 'drag') {
			
			//get mouse offset
			mouseOffset = getMouseOffset(target, e);
			///alert(mouseOffset);
    		
    		_offsetX = target.offsetLeft - e.clientX;
    		_offsetY = target.offsetTop - e.clientY;

    		// grab the mouse position
        	_startX = e.clientX;
        	_startY = e.clientY;
        	//alert('mouse position: ' + _startX + ', ' + _startY);
        	
        	let containerElement = document.getElementsByClassName('container')[0];
        	let containerRect = containerElement.getBoundingClientRect();
        	//alert(' Container: left= ' + containerRect.left + ', top= ' + containerRect.top + ', right= ' + containerRect.right + ', bottom= ' + containerRect.bottom);


        	let rect = target.getBoundingClientRect(); 
        	//alert('Drag Element: left= ' + rect.left + ', top= ' + rect.top + ', right= ' + rect.right + ', bottom= ' + rect.bottom);
        	//alert('rect.LeftTopRightBottom = ' + rect.left + ', ' + rect.top + ', ' + rect.right + ', ' + rect.bottom + '\n containerRect.LeftTopRightBottom = ' + containerRect.left + ', ' + containerRect.top + ', ' + containerRect.right + ', ' + containerRect.bottom);

        	// bring the clicked element to the front while it is being dragged
        	_oldZIndex = target.style.zIndex;
        	target.style.zIndex = 10000;

        	// we need to access the element in OnMouseMove
        	_dragElement = target;

        	// tell our code to start moving the element with the mouse
        	document.onmousemove = OnMouseMove;

        	// cancel out any text selections
        	document.body.focus();

        	// prevent text selection in IE
        	document.onselectstart = function () { return false; };
        	
        	// prevent IE from trying to drag an image
        	target.ondragstart = function() { return false; };
        
        	return false;
        }
    }
    
	</script>

	<script src='https://cdnjs.cloudflare.com/ajax/libs/materialize/0.100.2/js/materialize.min.js'></script>
	
</body>
</html>